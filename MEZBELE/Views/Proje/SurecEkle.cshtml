@model MEZBELE.ViewModels.VM
@{
    ViewBag.Title = "SurecEkle";
    Layout = "~/Views/Shared/App/_AppLayout.cshtml";
}

<h2>SurecEkle</h2>

<div class="row">
    <form class="col s12">
        <div class="row">
            <div class="input-field col s6">
                <input id="SurecAdi" type="text" name="Süreç Adı">
                <label for="SurecAdi">Süreç Adı</label>
            </div>
            <div class="input-field col s12">
                <textarea id="SurecAciklama" class="materialize-textarea"></textarea>
                <label for="SurecAciklama">Açıklama</label>
            </div>
            <input id="BaslangicTarihi" type="date" name="Başlangiç Tarihi" class="col s6">
            <input id="BitisTarihi" type="date" name="Bitiş Tarihi" class="col s6">
            <div class="input-field col s12">
                <input id="Oncelik" type="text" list="oncelik" name="Öncelik">
                <datalist id="oncelik">
                    <option value="1">Düşük</option>
                    <option value="2">Orta</option>
                    <option value="3">Yüksek</option>
                </datalist>
            </div>
            <a class="waves-effect waves-light btn" onclick="SureciKaydet(@Model.AktifProje.ID)">Kaydet</a>
        </div>
    </form>
</div>

<script>
    function SureciKaydet(projeID) {
        var kontrol = true;
        $('input').each(function () {
            if ($.trim($(this).val()) == "") {
                Materialize.toast(this.name + ' alanı boş bırakılamaz!', 3000, 'rounded');
                kontrol = false;
                $(this).addClass("invalid");
            } else {
                $(this).removeClass("invalid");
            }
        });
        if ($.trim($('#SurecAciklama').val()) == "") {
            Materialize.toast('Açıklama alanı boş bırakılamaz!', 3000, 'rounded');
            kontrol = false;
            $('#SurecAciklama').addClass("invalid");
        } else {
            $('#SurecAciklama').removeClass("invalid");
        }

        if (kontrol) {
            var surec = {
                SurecAdi: $("#SurecAdi").val(),
                Aciklama: $("#SurecAciklama").val(),
                BaslamaTarihi: $("#BaslangicTarihi").val(),
                BitisTarihi: $("#BitisTarihi").val(),
                Oncelik: $("#Oncelik").val(),
                ProjeID: projeID
            };
            console.log(surec);

            $.post("../Proje/SurecKaydet", surec, function (sonuc) {
                console.log(sonuc);
            });
        }
        
    }
</script>